<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>–£–≥–∞–¥–∞–π —Ä–∏—Å—É–Ω–æ–∫!</title>
    <link rel="stylesheet" href="/style.css">
</head>
<body>
    <h1>ü§î –ß—Ç–æ —Ä–∏—Å—É–µ—Ç —Ö—É–¥–æ–∂–Ω–∏–∫?</h1>
    <canvas id="canvas" width="500" height="500" style="border: 3px solid #333; background: white;"></canvas>

    <div class="tools">
        <button id="playBtn">‚ñ∂ –°–º–æ—Ç—Ä–µ—Ç—å —Ä–∏—Å—É–Ω–æ–∫</button>
        <div id="guessZone" style="margin-top: 20px;">
            <input type="text" id="userGuess" placeholder="–í–∞—à –æ—Ç–≤–µ—Ç...">
            <button id="checkBtn">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å</button>
        </div>
        <p id="feedback" style="font-weight: bold; font-size: 20px;"></p>
    </div>

    <script>
        const canvas = document.getElementById("canvas");
        const ctx = canvas.getContext("2d");
        let correctWord = ""; // –ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ —Å–ª–æ–≤–æ

        // –ü–æ–ª—É—á–∞–µ–º id —Ä–∏—Å—É–Ω–∫–∞ –∏–∑ URL
        const drawingId = window.location.pathname.split("/").pop();

        let drawingData = null;

        // –ó–∞–≥—Ä—É–∂–∞–µ–º —Ä–∏—Å—É–Ω–æ–∫ –ø–æ API
        async function loadDrawing() {
            try {
                const res = await fetch(`/api/draw/${drawingId}`);
                if (!res.ok) throw new Error("–†–∏—Å—É–Ω–æ–∫ –Ω–µ –Ω–∞–π–¥–µ–Ω");
                drawingData = await res.json();
                correctWord = drawingData.word.toLowerCase().trim();
            } catch (err) {
                alert(err.message);
            }
        }

        // –í–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ —Ä–∏—Å—É–Ω–∫–∞ –Ω–∞ canvas
        function playDrawing() {
            if (!drawingData) return;
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            let i = 0;
            function step() {
                if (i >= drawingData.timeline.length) return;
                const p = drawingData.timeline[i];
                if (p.type === "start") {
                    ctx.beginPath();
                    ctx.strokeStyle = p.color;
                    ctx.lineWidth = 4;
                    ctx.lineCap = "round";
                    ctx.moveTo(p.x, p.y);
                } else if (p.type === "draw") {
                    ctx.lineTo(p.x, p.y);
                    ctx.stroke();
                }
                i++;
                setTimeout(step, 10);
            }
            step();
        }

        // –ö–Ω–æ–ø–∫–∞ ¬´–°–º–æ—Ç—Ä–µ—Ç—å —Ä–∏—Å—É–Ω–æ–∫¬ª
        document.getElementById("playBtn").onclick = playDrawing;

        // –ö–Ω–æ–ø–∫–∞ ¬´–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–ª–æ–≤–æ¬ª
        document.getElementById("checkBtn").onclick = () => {
            const guess = document.getElementById("userGuess").value.toLowerCase().trim();
            const feedback = document.getElementById("feedback");

            if (guess === correctWord) {
                feedback.innerText = "‚úÖ –í–µ—Ä–Ω–æ! –≠—Ç–æ " + correctWord.toUpperCase();
                feedback.style.color = "green";
            } else {
                feedback.innerText = "‚ùå –ù–µ—Ç, –ø–æ–ø—Ä–æ–±—É–π –µ—â–µ —Ä–∞–∑!";
                feedback.style.color = "red";
            }
        };

        // –ó–∞–≥—Ä—É–∂–∞–µ–º —Ä–∏—Å—É–Ω–æ–∫ –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        loadDrawing();
    </script>
</body>
</html>
